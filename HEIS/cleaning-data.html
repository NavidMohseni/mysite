<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Cleaning data | Household Expenditure and Income Surveys of Iran</title>
  <meta name="description" content="The Household Expenditure and Income Surveys of Iran: Introduction and data cleaning" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Cleaning data | Household Expenditure and Income Surveys of Iran" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Household Expenditure and Income Surveys of Iran: Introduction and data cleaning" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Cleaning data | Household Expenditure and Income Surveys of Iran" />
  
  <meta name="twitter:description" content="The Household Expenditure and Income Surveys of Iran: Introduction and data cleaning" />
  

<meta name="author" content="Mohammad Hoseini and Avenia Ghazarian" />


<meta name="date" content="2020-08-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="importing-raw-data.html"/>
<link rel="next" href="price-adjustment-and-appending.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#sample-design"><i class="fa fa-check"></i><b>1.1</b> Sample design</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#rotating-panel-feature"><i class="fa fa-check"></i><b>1.1.1</b> Rotating panel feature</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#different-rounds"><i class="fa fa-check"></i><b>1.2</b> Different rounds</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="questionnaire-details.html"><a href="questionnaire-details.html"><i class="fa fa-check"></i><b>2</b> Questionnaire details</a><ul>
<li class="chapter" data-level="2.1" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-1---member-characteristics"><i class="fa fa-check"></i><b>2.1</b> Part 1 - Member Characteristics</a></li>
<li class="chapter" data-level="2.2" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-2---household-facilities"><i class="fa fa-check"></i><b>2.2</b> Part 2 - Household Facilities</a></li>
<li class="chapter" data-level="2.3" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-3---expenditure"><i class="fa fa-check"></i><b>2.3</b> Part 3 - Expenditure</a></li>
<li class="chapter" data-level="2.4" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-4-income"><i class="fa fa-check"></i><b>2.4</b> Part 4: Income</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importing-raw-data.html"><a href="importing-raw-data.html"><i class="fa fa-check"></i><b>3</b> Importing raw data</a><ul>
<li class="chapter" data-level="3.1" data-path="importing-raw-data.html"><a href="importing-raw-data.html#importing-access-files-to-r"><i class="fa fa-check"></i><b>3.1</b> Importing access files to R</a></li>
<li class="chapter" data-level="3.2" data-path="importing-raw-data.html"><a href="importing-raw-data.html#importing-code-for-all-years"><i class="fa fa-check"></i><b>3.2</b> Importing code for all years</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-data.html"><a href="cleaning-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning data</a><ul>
<li class="chapter" data-level="4.1" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-1-2"><i class="fa fa-check"></i><b>4.1</b> Cleaning Part 1 &amp; 2</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-3"><i class="fa fa-check"></i><b>4.2</b> Cleaning Part 3</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-4"><i class="fa fa-check"></i><b>4.3</b> Cleaning Part 4</a><ul>
<li class="chapter" data-level="4.3.1" data-path="cleaning-data.html"><a href="cleaning-data.html#non-monetary-income"><i class="fa fa-check"></i><b>4.3.1</b> Non-monetary income</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="cleaning-data.html"><a href="cleaning-data.html#building-individual-level-data"><i class="fa fa-check"></i><b>4.4</b> Building individual-level data</a></li>
<li class="chapter" data-level="4.5" data-path="cleaning-data.html"><a href="cleaning-data.html#building-household-level-data-summary-files"><i class="fa fa-check"></i><b>4.5</b> Building Household-level data (summary files)</a></li>
<li class="chapter" data-level="4.6" data-path="cleaning-data.html"><a href="cleaning-data.html#special-issues-for-different-years"><i class="fa fa-check"></i><b>4.6</b> Special issues for different years</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="price-adjustment-and-appending.html"><a href="price-adjustment-and-appending.html"><i class="fa fa-check"></i><b>5</b> Price adjustment and appending</a><ul>
<li class="chapter" data-level="5.1" data-path="price-adjustment-and-appending.html"><a href="price-adjustment-and-appending.html#price-adjustment"><i class="fa fa-check"></i><b>5.1</b> Price Adjustment</a></li>
<li class="chapter" data-level="5.2" data-path="price-adjustment-and-appending.html"><a href="price-adjustment-and-appending.html#merging-individual-level-data-overtime"><i class="fa fa-check"></i><b>5.2</b> Merging individual level data overtime</a></li>
<li class="chapter" data-level="5.3" data-path="price-adjustment-and-appending.html"><a href="price-adjustment-and-appending.html#merging-household-level-data-over-time"><i class="fa fa-check"></i><b>5.3</b> Merging household-level data over time</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="overall-trends.html"><a href="overall-trends.html"><i class="fa fa-check"></i><b>6</b> Overall trends</a><ul>
<li class="chapter" data-level="6.1" data-path="overall-trends.html"><a href="overall-trends.html#trends-in-expenditure-items"><i class="fa fa-check"></i><b>6.1</b> Trends in expenditure items</a></li>
<li class="chapter" data-level="6.2" data-path="overall-trends.html"><a href="overall-trends.html#trends-of-individual-level-data"><i class="fa fa-check"></i><b>6.2</b> Trends of individual level data</a></li>
<li class="chapter" data-level="6.3" data-path="overall-trends.html"><a href="overall-trends.html#trends-of-household-level-data-over-time"><i class="fa fa-check"></i><b>6.3</b> Trends of household-level data over time</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Household Expenditure and Income Surveys of Iran</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-data" class="section level1">
<h1><span class="header-section-number">4</span> Cleaning data</h1>
<style type="text/css">
pre {
  max-height: 500px;
  overflow-y: auto;
}

pre[class] {
  max-height: 500px;
}
</style>
<p>The raw data in <em>rdata</em> format, consists of a number of dataframes each corresponding to a table in the questionnaire. The name of each dataframe informs the user about region, year, part and table number. Forexample, R97P3S01 contains Table 1 (food) of Part 3 (expenditure item) for R (rural) sample of year 97. Our data cleaning process has different steps:</p>
<ul>
<li>for each year of survey we write an script to reconcile variable names and codings.</li>
<li>we match item codes with detailed price index</li>
<li>we merge different rounds and build household and individual level datasets overtime.</li>
</ul>
<p>This chapter describes the structure of script for each survey year and present a sample code written for 1397. The output of each script, in addition to the cleaned raw data, would be 3 <em>.RDS</em> files for rural and urban regions (which can be easily exported to <em>.xlsx</em> or <em>.dta</em> formats) including (1) household-level, (2) individual-level, (3) item-level dataframes. For example the script of 1397 survey, takes the <em>97.Rdata</em> file as input and creates the following 7 files as output:</p>
<ul>
<li><em>HEIS97.Rdata</em></li>
<li><em>R97Household.RDS</em> and <em>U97Household.RDS</em></li>
<li><em>R97Individual.RDS</em> and <em>U97Individual.RDS</em></li>
<li><em>R97Expenditure.RDS</em> and <em>U97Expenditure.RDS</em></li>
</ul>
<p>The year-wise scripts can be downloaded from here: <a href="https://bit.ly/3a9BTI0" class="uri">https://bit.ly/3a9BTI0</a></p>
<p>In each yearly scripts we do the folling steps:</p>
<ul>
<li>rename variable to have unique names over time</li>
<li>recode expenditure items to have global code over time</li>
<li>merging tables of part 3 to build a unique expenditure dataframe</li>
<li>merging part 1 and part 4 to build individual-level data on characteristics and income</li>
<li>aggregating expenditures and income to make household-level data</li>
</ul>
<div id="cleaning-part-1-2" class="section level2">
<h2><span class="header-section-number">4.1</span> Cleaning Part 1 &amp; 2</h2>
<p>For part 1 and 2, we change variable names to have unique names over time. The below code shows the name list of 1397. In this code, the last two lines regarding Part 1 are for generating variables for province and town codes. The information on the location is available in household ID variables which is titled as “Address” in the surveys. <span style="color:red"> The structure of Address is also changing over time: explain the details here </span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">load</span>(<span class="st">&quot;C:/HBS/97.RData&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co"># Part 1</span></a>
<a class="sourceLine" id="cb1-6" title="6">R97P1 &lt;-<span class="st"> </span>R97P1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="dt">relation =</span> DYCOL03,</a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="dt">gender =</span> DYCOL04,</a>
<a class="sourceLine" id="cb1-11" title="11">    <span class="dt">age =</span> DYCOL05,</a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="dt">literacy =</span> DYCOL06,</a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="dt">studying =</span> DYCOL07,</a>
<a class="sourceLine" id="cb1-14" title="14">    <span class="dt">degree =</span> DYCOL08,</a>
<a class="sourceLine" id="cb1-15" title="15">    <span class="dt">occupationalst =</span> DYCOL09,</a>
<a class="sourceLine" id="cb1-16" title="16">    <span class="dt">maritalst =</span> DYCOL10 ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">province =</span> <span class="kw">substr</span>(Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb1-18" title="18">          <span class="dt">town =</span> <span class="kw">substr</span>(Address, <span class="dv">4</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1-19" title="19">          )</a>
<a class="sourceLine" id="cb1-20" title="20"></a>
<a class="sourceLine" id="cb1-21" title="21">U97P1 &lt;-<span class="st"> </span>U97P1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb1-23" title="23">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb1-24" title="24">    <span class="dt">relation =</span> DYCOL03,</a>
<a class="sourceLine" id="cb1-25" title="25">    <span class="dt">gender =</span> DYCOL04,</a>
<a class="sourceLine" id="cb1-26" title="26">    <span class="dt">age =</span> DYCOL05,</a>
<a class="sourceLine" id="cb1-27" title="27">    <span class="dt">literacy =</span> DYCOL06,</a>
<a class="sourceLine" id="cb1-28" title="28">    <span class="dt">studying =</span> DYCOL07,</a>
<a class="sourceLine" id="cb1-29" title="29">    <span class="dt">degree =</span> DYCOL08,</a>
<a class="sourceLine" id="cb1-30" title="30">    <span class="dt">occupationalst =</span> DYCOL09,</a>
<a class="sourceLine" id="cb1-31" title="31">    <span class="dt">maritalst =</span> DYCOL10 ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-32" title="32"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">province =</span> <span class="kw">substr</span>(Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb1-33" title="33">          <span class="dt">town =</span> <span class="kw">substr</span>(Address, <span class="dv">4</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1-34" title="34">  )</a>
<a class="sourceLine" id="cb1-35" title="35"></a>
<a class="sourceLine" id="cb1-36" title="36"><span class="co"># Part 2</span></a>
<a class="sourceLine" id="cb1-37" title="37">R97P2 &lt;-<span class="st"> </span>R97P2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-38" title="38"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb1-39" title="39">    <span class="dt">tenure =</span> DYCOL01,</a>
<a class="sourceLine" id="cb1-40" title="40">    <span class="dt">room =</span> DYCOL03,</a>
<a class="sourceLine" id="cb1-41" title="41">    <span class="dt">space =</span> DYCOL04,</a>
<a class="sourceLine" id="cb1-42" title="42">    <span class="dt">construction =</span> DYCOL05,</a>
<a class="sourceLine" id="cb1-43" title="43">    <span class="dt">material =</span> DYCOL06,</a>
<a class="sourceLine" id="cb1-44" title="44">    <span class="dt">vehicle =</span> DYCOL07,</a>
<a class="sourceLine" id="cb1-45" title="45">    <span class="dt">motorcycle =</span> DYCOL08,</a>
<a class="sourceLine" id="cb1-46" title="46">    <span class="dt">bicycle =</span> DYCOL09,</a>
<a class="sourceLine" id="cb1-47" title="47">    <span class="dt">radio =</span> DYCOL10,</a>
<a class="sourceLine" id="cb1-48" title="48">    <span class="dt">radiotape =</span> DYCOL11,</a>
<a class="sourceLine" id="cb1-49" title="49">    <span class="dt">TVbw =</span> DYCOL12,</a>
<a class="sourceLine" id="cb1-50" title="50">    <span class="dt">TV =</span> DYCOL13,</a>
<a class="sourceLine" id="cb1-51" title="51">    <span class="dt">VHS_VCD_DVD =</span> DYCOL14,</a>
<a class="sourceLine" id="cb1-52" title="52">    <span class="dt">computer =</span> DYCOL15,</a>
<a class="sourceLine" id="cb1-53" title="53">    <span class="dt">cellphone =</span> DYCOL16,</a>
<a class="sourceLine" id="cb1-54" title="54">    <span class="dt">freezer =</span> DYCOL17,</a>
<a class="sourceLine" id="cb1-55" title="55">    <span class="dt">refridgerator =</span> DYCOL18,</a>
<a class="sourceLine" id="cb1-56" title="56">    <span class="dt">fridge =</span> DYCOL19,</a>
<a class="sourceLine" id="cb1-57" title="57">    <span class="dt">stove =</span> DYCOL20,</a>
<a class="sourceLine" id="cb1-58" title="58">    <span class="dt">vacuum =</span> DYCOL21,</a>
<a class="sourceLine" id="cb1-59" title="59">    <span class="dt">washingmachine =</span> DYCOL22,</a>
<a class="sourceLine" id="cb1-60" title="60">    <span class="dt">sewingmachine =</span> DYCOL23,</a>
<a class="sourceLine" id="cb1-61" title="61">    <span class="dt">fan =</span> DYCOL24,</a>
<a class="sourceLine" id="cb1-62" title="62">    <span class="dt">evapcoolingportable =</span> DYCOL25,</a>
<a class="sourceLine" id="cb1-63" title="63">    <span class="dt">splitportable =</span> DYCOL26,</a>
<a class="sourceLine" id="cb1-64" title="64">    <span class="dt">dishwasher =</span> DYCOL27,</a>
<a class="sourceLine" id="cb1-65" title="65">    <span class="dt">none =</span> DYCOL29,</a>
<a class="sourceLine" id="cb1-66" title="66">    <span class="dt">pipewater =</span> DYCOL30,</a>
<a class="sourceLine" id="cb1-67" title="67">    <span class="dt">electricity =</span> DYCOL31,</a>
<a class="sourceLine" id="cb1-68" title="68">    <span class="dt">pipegas =</span> DYCOL32,</a>
<a class="sourceLine" id="cb1-69" title="69">    <span class="dt">telephone =</span> DYCOL33,</a>
<a class="sourceLine" id="cb1-70" title="70">    <span class="dt">internet  =</span> DYCOL34,</a>
<a class="sourceLine" id="cb1-71" title="71">    <span class="dt">bathroom =</span> DYCOL35,</a>
<a class="sourceLine" id="cb1-72" title="72">    <span class="dt">kitchen =</span> DYCOL36,</a>
<a class="sourceLine" id="cb1-73" title="73">    <span class="dt">evapcooling =</span> DYCOL37,</a>
<a class="sourceLine" id="cb1-74" title="74">    <span class="dt">centralcooling =</span> DYCOL38,</a>
<a class="sourceLine" id="cb1-75" title="75">    <span class="dt">centralheating =</span> DYCOL39,</a>
<a class="sourceLine" id="cb1-76" title="76">    <span class="dt">package =</span> DYCOL40,</a>
<a class="sourceLine" id="cb1-77" title="77">    <span class="dt">split =</span> DYCOL41,</a>
<a class="sourceLine" id="cb1-78" title="78">    <span class="dt">wastewater =</span> DYCOL42,</a>
<a class="sourceLine" id="cb1-79" title="79">    <span class="dt">cookingfuel =</span> DYCOL43,</a>
<a class="sourceLine" id="cb1-80" title="80">    <span class="dt">heatingfuel =</span> DYCOL44,</a>
<a class="sourceLine" id="cb1-81" title="81">    <span class="dt">waterheatingfuel =</span> DYCOL45)</a>
<a class="sourceLine" id="cb1-82" title="82"></a>
<a class="sourceLine" id="cb1-83" title="83">U97P2 &lt;-<span class="st"> </span>U97P2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-84" title="84"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb1-85" title="85">    <span class="dt">tenure =</span> DYCOL01,</a>
<a class="sourceLine" id="cb1-86" title="86">    <span class="dt">room =</span> DYCOL03,</a>
<a class="sourceLine" id="cb1-87" title="87">    <span class="dt">space =</span> DYCOL04,</a>
<a class="sourceLine" id="cb1-88" title="88">    <span class="dt">construction =</span> DYCOL05,</a>
<a class="sourceLine" id="cb1-89" title="89">    <span class="dt">material =</span> DYCOL06,</a>
<a class="sourceLine" id="cb1-90" title="90">    <span class="dt">vehicle =</span> DYCOL07,</a>
<a class="sourceLine" id="cb1-91" title="91">    <span class="dt">motorcycle =</span> DYCOL08,</a>
<a class="sourceLine" id="cb1-92" title="92">    <span class="dt">bicycle =</span> DYCOL09,</a>
<a class="sourceLine" id="cb1-93" title="93">    <span class="dt">radio =</span> DYCOL10,</a>
<a class="sourceLine" id="cb1-94" title="94">    <span class="dt">radiotape =</span> DYCOL11,</a>
<a class="sourceLine" id="cb1-95" title="95">    <span class="dt">TVbw =</span> DYCOL12,</a>
<a class="sourceLine" id="cb1-96" title="96">    <span class="dt">TV =</span> DYCOL13,</a>
<a class="sourceLine" id="cb1-97" title="97">    <span class="dt">VHS_VCD_DVD =</span> DYCOL14,</a>
<a class="sourceLine" id="cb1-98" title="98">    <span class="dt">computer =</span> DYCOL15,</a>
<a class="sourceLine" id="cb1-99" title="99">    <span class="dt">cellphone =</span> DYCOL16,</a>
<a class="sourceLine" id="cb1-100" title="100">    <span class="dt">freezer =</span> DYCOL17,</a>
<a class="sourceLine" id="cb1-101" title="101">    <span class="dt">refridgerator =</span> DYCOL18,</a>
<a class="sourceLine" id="cb1-102" title="102">    <span class="dt">fridge =</span> DYCOL19,</a>
<a class="sourceLine" id="cb1-103" title="103">    <span class="dt">stove =</span> DYCOL20,</a>
<a class="sourceLine" id="cb1-104" title="104">    <span class="dt">vacuum =</span> DYCOL21,</a>
<a class="sourceLine" id="cb1-105" title="105">    <span class="dt">washingmachine =</span> DYCOL22,</a>
<a class="sourceLine" id="cb1-106" title="106">    <span class="dt">sewingmachine =</span> DYCOL23,</a>
<a class="sourceLine" id="cb1-107" title="107">    <span class="dt">fan =</span> DYCOL24,</a>
<a class="sourceLine" id="cb1-108" title="108">    <span class="dt">evapcoolingportable =</span> DYCOL25,</a>
<a class="sourceLine" id="cb1-109" title="109">    <span class="dt">splitportable =</span> DYCOL26,</a>
<a class="sourceLine" id="cb1-110" title="110">    <span class="dt">dishwasher =</span> DYCOL27,</a>
<a class="sourceLine" id="cb1-111" title="111">    <span class="dt">none =</span> DYCOL29,</a>
<a class="sourceLine" id="cb1-112" title="112">    <span class="dt">pipewater =</span> DYCOL30,</a>
<a class="sourceLine" id="cb1-113" title="113">    <span class="dt">electricity =</span> DYCOL31,</a>
<a class="sourceLine" id="cb1-114" title="114">    <span class="dt">pipegas =</span> DYCOL32,</a>
<a class="sourceLine" id="cb1-115" title="115">    <span class="dt">telephone =</span> DYCOL33,</a>
<a class="sourceLine" id="cb1-116" title="116">    <span class="dt">internet  =</span> DYCOL34,</a>
<a class="sourceLine" id="cb1-117" title="117">    <span class="dt">bathroom =</span> DYCOL35,</a>
<a class="sourceLine" id="cb1-118" title="118">    <span class="dt">kitchen =</span> DYCOL36,</a>
<a class="sourceLine" id="cb1-119" title="119">    <span class="dt">evapcooling =</span> DYCOL37,</a>
<a class="sourceLine" id="cb1-120" title="120">    <span class="dt">centralcooling =</span> DYCOL38,</a>
<a class="sourceLine" id="cb1-121" title="121">    <span class="dt">centralheating =</span> DYCOL39,</a>
<a class="sourceLine" id="cb1-122" title="122">    <span class="dt">package =</span> DYCOL40,</a>
<a class="sourceLine" id="cb1-123" title="123">    <span class="dt">split =</span> DYCOL41,</a>
<a class="sourceLine" id="cb1-124" title="124">    <span class="dt">wastewater =</span> DYCOL42,</a>
<a class="sourceLine" id="cb1-125" title="125">    <span class="dt">cookingfuel =</span> DYCOL43,</a>
<a class="sourceLine" id="cb1-126" title="126">    <span class="dt">heatingfuel =</span> DYCOL44,</a>
<a class="sourceLine" id="cb1-127" title="127">    <span class="dt">waterheatingfuel =</span> DYCOL45 )</a></code></pre></div>
</div>
<div id="cleaning-part-3" class="section level2">
<h2><span class="header-section-number">4.2</span> Cleaning Part 3</h2>
<p>The most cumbersome step to clean HEIS is match expenditure items data overtime and adjust the value by price indices. We first rename all columns to have exactly the same name over different rounds of surveys and then define a unique code for each expenditure item. As expenditure categories are changing over time and in many cases a more general classification is deomposed into different categories, our global codes covers both general and detailed classifications. For example in one year there is an expenditure item ‘fruit’ and in the next year it is decomposed into ‘apple’, ‘banana’ and other fruits. We then would have 4 global codes: 1-fruit, 2-apple, 3-banana, 4-other fruits. Later we explain how the global codes are used for adjusting expenditure values by price index.</p>
<p><span style="color:red"> <strong>we should add here more details about expenditure code definition and how we match differet rounds of it with some examples perhaps</strong> </span></p>
<p>Here is a sample code for 1397 to rename variables and define unique item code as <em>DYCOL00</em> :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">setwd</span>(<span class="st">&quot;C:/HBS/&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co"># Year 97</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw">load</span>(<span class="st">&quot;97.RData&quot;</span>)</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co"># Adding Global variable as DYCOL00</span></a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co"># Part 3, Table 1</span></a>
<a class="sourceLine" id="cb2-12" title="12">R97P3S01 &lt;-<span class="st"> </span>R97P3S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-15" title="15">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-16" title="16">    <span class="dt">gram =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-17" title="17">    <span class="dt">kilogram =</span> DYCOL04,</a>
<a class="sourceLine" id="cb2-18" title="18">    <span class="dt">price =</span> DYCOL05,</a>
<a class="sourceLine" id="cb2-19" title="19">    <span class="dt">value =</span> DYCOL06  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-21" title="21">    code <span class="op">==</span><span class="st"> </span><span class="dv">11241</span> <span class="op">~</span><span class="st"> </span>11240L,</a>
<a class="sourceLine" id="cb2-22" title="22">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-23" title="23">  )</a>
<a class="sourceLine" id="cb2-24" title="24"></a>
<a class="sourceLine" id="cb2-25" title="25">R97P3S01<span class="op">$</span>price &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">levels</span>(R97P3S01<span class="op">$</span>price))[R97P3S01<span class="op">$</span>price] <span class="co">#change factor to numeric</span></a>
<a class="sourceLine" id="cb2-26" title="26"></a>
<a class="sourceLine" id="cb2-27" title="27">U97P3S01 &lt;-<span class="st"> </span>U97P3S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-29" title="29">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-30" title="30">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-31" title="31">    <span class="dt">gram =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-32" title="32">    <span class="dt">kilogram =</span> DYCOL04,</a>
<a class="sourceLine" id="cb2-33" title="33">    <span class="dt">price =</span> DYCOL05,</a>
<a class="sourceLine" id="cb2-34" title="34">    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-35" title="35"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-36" title="36">    code <span class="op">==</span><span class="st"> </span><span class="dv">11241</span> <span class="op">~</span><span class="st"> </span>11240L,</a>
<a class="sourceLine" id="cb2-37" title="37">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-38" title="38">  )</a>
<a class="sourceLine" id="cb2-39" title="39"></a>
<a class="sourceLine" id="cb2-40" title="40"><span class="co"># Part 3, Table 2</span></a>
<a class="sourceLine" id="cb2-41" title="41">R97P3S02 &lt;-<span class="st"> </span>R97P3S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-42" title="42"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-43" title="43">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-44" title="44">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-45" title="45">    <span class="dt">gram =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-46" title="46">    <span class="dt">kilogram =</span> DYCOL04,</a>
<a class="sourceLine" id="cb2-47" title="47">    <span class="dt">price =</span> DYCOL05,</a>
<a class="sourceLine" id="cb2-48" title="48">    <span class="dt">value =</span> DYCOL06) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-49" title="49"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-50" title="50"></a>
<a class="sourceLine" id="cb2-51" title="51">U97P3S02 &lt;-<span class="st"> </span>U97P3S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-52" title="52"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-53" title="53">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-54" title="54">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-55" title="55">    <span class="dt">gram =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-56" title="56">    <span class="dt">kilogram =</span> DYCOL04,</a>
<a class="sourceLine" id="cb2-57" title="57">    <span class="dt">price =</span> DYCOL05,</a>
<a class="sourceLine" id="cb2-58" title="58">    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-59" title="59"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-60" title="60"></a>
<a class="sourceLine" id="cb2-61" title="61"><span class="co"># Part 3, Table 3</span></a>
<a class="sourceLine" id="cb2-62" title="62">R97P3S03 &lt;-<span class="st"> </span>R97P3S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-63" title="63"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-64" title="64">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-65" title="65">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-66" title="66">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-67" title="67"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-68" title="68">    code <span class="op">==</span><span class="st"> </span><span class="dv">31244</span> <span class="op">~</span><span class="st"> </span>31255L,</a>
<a class="sourceLine" id="cb2-69" title="69">    code <span class="op">==</span><span class="st"> </span><span class="dv">31269</span> <span class="op">~</span><span class="st"> </span>31263L,</a>
<a class="sourceLine" id="cb2-70" title="70">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code) </a>
<a class="sourceLine" id="cb2-71" title="71">  )</a>
<a class="sourceLine" id="cb2-72" title="72"></a>
<a class="sourceLine" id="cb2-73" title="73">U97P3S03 &lt;-<span class="st"> </span>U97P3S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-74" title="74"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-75" title="75">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-76" title="76">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-77" title="77">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-78" title="78"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-79" title="79">    code <span class="op">==</span><span class="st"> </span><span class="dv">31244</span> <span class="op">~</span><span class="st"> </span>31255L,</a>
<a class="sourceLine" id="cb2-80" title="80">    code <span class="op">==</span><span class="st"> </span><span class="dv">31269</span> <span class="op">~</span><span class="st"> </span>31263L,</a>
<a class="sourceLine" id="cb2-81" title="81">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-82" title="82">  )</a>
<a class="sourceLine" id="cb2-83" title="83"></a>
<a class="sourceLine" id="cb2-84" title="84"><span class="co"># Part 3, Table 4</span></a>
<a class="sourceLine" id="cb2-85" title="85">R97P3S04 &lt;-<span class="st"> </span>R97P3S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-86" title="86"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-87" title="87">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-88" title="88">    <span class="dt">mortgage =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-89" title="89">    <span class="dt">purchased =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-90" title="90">    <span class="dt">value =</span> DYCOL04 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-91" title="91"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-92" title="92">    code <span class="op">==</span><span class="st"> </span><span class="dv">44418</span> <span class="op">~</span><span class="st"> </span>44419L,</a>
<a class="sourceLine" id="cb2-93" title="93">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-94" title="94">  )</a>
<a class="sourceLine" id="cb2-95" title="95"></a>
<a class="sourceLine" id="cb2-96" title="96">U97P3S04 &lt;-<span class="st"> </span>U97P3S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-97" title="97"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-98" title="98">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-99" title="99">    <span class="dt">mortgage =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-100" title="100">    <span class="dt">purchased =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-101" title="101">    <span class="dt">value =</span> DYCOL04 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-102" title="102"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-103" title="103">    code <span class="op">==</span><span class="st"> </span><span class="dv">44418</span> <span class="op">~</span><span class="st"> </span>44419L,</a>
<a class="sourceLine" id="cb2-104" title="104">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-105" title="105">  )</a>
<a class="sourceLine" id="cb2-106" title="106"></a>
<a class="sourceLine" id="cb2-107" title="107"><span class="co"># Part 3, Table 5</span></a>
<a class="sourceLine" id="cb2-108" title="108">R97P3S05 &lt;-<span class="st"> </span>R97P3S05 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-109" title="109"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-110" title="110">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-111" title="111">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-112" title="112">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-113" title="113"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-114" title="114"></a>
<a class="sourceLine" id="cb2-115" title="115">U97P3S05 &lt;-<span class="st"> </span>U97P3S05 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-116" title="116"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-117" title="117">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-118" title="118">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-119" title="119">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-120" title="120"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-121" title="121"></a>
<a class="sourceLine" id="cb2-122" title="122"></a>
<a class="sourceLine" id="cb2-123" title="123"><span class="co"># Part 3, Table 6</span></a>
<a class="sourceLine" id="cb2-124" title="124">R97P3S06 &lt;-<span class="st"> </span>R97P3S06  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-125" title="125"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-126" title="126">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-127" title="127">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-128" title="128">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-129" title="129"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-130" title="130">    code <span class="op">==</span><span class="st"> </span><span class="dv">62128</span> <span class="op">~</span><span class="st"> </span>62125L,</a>
<a class="sourceLine" id="cb2-131" title="131">    code <span class="op">==</span><span class="st"> </span><span class="dv">62129</span> <span class="op">~</span><span class="st"> </span>62126L,</a>
<a class="sourceLine" id="cb2-132" title="132">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-133" title="133">  )</a>
<a class="sourceLine" id="cb2-134" title="134">U97P3S06 &lt;-<span class="st"> </span>U97P3S06 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-135" title="135"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-136" title="136">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-137" title="137">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-138" title="138">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-139" title="139"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-140" title="140">    code <span class="op">==</span><span class="st"> </span><span class="dv">62128</span> <span class="op">~</span><span class="st"> </span>62125L,</a>
<a class="sourceLine" id="cb2-141" title="141">    code <span class="op">==</span><span class="st"> </span><span class="dv">62129</span> <span class="op">~</span><span class="st"> </span>62126L,</a>
<a class="sourceLine" id="cb2-142" title="142">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-143" title="143">  )</a>
<a class="sourceLine" id="cb2-144" title="144"></a>
<a class="sourceLine" id="cb2-145" title="145"><span class="co"># Part 3, Table 7</span></a>
<a class="sourceLine" id="cb2-146" title="146">R97P3S07 &lt;-<span class="st"> </span>R97P3S07 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-147" title="147"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-148" title="148">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-149" title="149">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-150" title="150">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-151" title="151"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-152" title="152">    code <span class="op">==</span><span class="st"> </span><span class="dv">73611</span> <span class="op">~</span><span class="st"> </span>73615L,</a>
<a class="sourceLine" id="cb2-153" title="153">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-154" title="154">  )</a>
<a class="sourceLine" id="cb2-155" title="155">U97P3S07 &lt;-<span class="st"> </span>U97P3S07 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-156" title="156"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-157" title="157">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-158" title="158">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-159" title="159">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-160" title="160"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-161" title="161">    code <span class="op">==</span><span class="st"> </span><span class="dv">73611</span> <span class="op">~</span><span class="st"> </span>73615L,</a>
<a class="sourceLine" id="cb2-162" title="162">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-163" title="163">  )</a>
<a class="sourceLine" id="cb2-164" title="164"></a>
<a class="sourceLine" id="cb2-165" title="165"><span class="co"># Part 3, Table 8</span></a>
<a class="sourceLine" id="cb2-166" title="166">R97P3S08 &lt;-<span class="st"> </span>R97P3S08<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-167" title="167"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-168" title="168">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-169" title="169">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-170" title="170">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-171" title="171"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-172" title="172"></a>
<a class="sourceLine" id="cb2-173" title="173">U97P3S08 &lt;-<span class="st"> </span>U97P3S08<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-174" title="174"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-175" title="175">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-176" title="176">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-177" title="177">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-178" title="178"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-179" title="179"></a>
<a class="sourceLine" id="cb2-180" title="180"><span class="co"># Part 3, Table 9</span></a>
<a class="sourceLine" id="cb2-181" title="181">R97P3S09 &lt;-<span class="st"> </span>R97P3S09 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-182" title="182"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-183" title="183">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-184" title="184">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-185" title="185">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-186" title="186"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-187" title="187"></a>
<a class="sourceLine" id="cb2-188" title="188">U97P3S09 &lt;-<span class="st"> </span>U97P3S09 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-189" title="189"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-190" title="190">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-191" title="191">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-192" title="192">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-193" title="193"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-194" title="194"></a>
<a class="sourceLine" id="cb2-195" title="195"><span class="co"># Part 3, Table 10</span></a>
<a class="sourceLine" id="cb2-196" title="196">R97P3S10 &lt;-<span class="st"> </span>R97P3S10 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-197" title="197"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-198" title="198">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-199" title="199">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-200" title="200">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-201" title="201"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-202" title="202"></a>
<a class="sourceLine" id="cb2-203" title="203">U97P3S10 &lt;-<span class="st"> </span>U97P3S10 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-204" title="204"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-205" title="205">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-206" title="206">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-207" title="207">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-208" title="208"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-209" title="209"></a>
<a class="sourceLine" id="cb2-210" title="210"><span class="co"># Part 3, Table 11</span></a>
<a class="sourceLine" id="cb2-211" title="211">R97P3S11 &lt;-<span class="st"> </span>R97P3S11 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-212" title="212"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-213" title="213">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-214" title="214">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-215" title="215">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-216" title="216"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-217" title="217"></a>
<a class="sourceLine" id="cb2-218" title="218">U97P3S11 &lt;-<span class="st"> </span>U97P3S11 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-219" title="219"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-220" title="220">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-221" title="221">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-222" title="222">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-223" title="223"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-224" title="224"></a>
<a class="sourceLine" id="cb2-225" title="225"><span class="co"># Part 3, Table 12</span></a>
<a class="sourceLine" id="cb2-226" title="226">R97P3S12 &lt;-<span class="st"> </span>R97P3S12 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-227" title="227"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-228" title="228">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-229" title="229">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-230" title="230">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-231" title="231"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-232" title="232"></a>
<a class="sourceLine" id="cb2-233" title="233">U97P3S12 &lt;-<span class="st"> </span>U97P3S12 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-234" title="234"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-235" title="235">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-236" title="236">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-237" title="237">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-238" title="238"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code)</a>
<a class="sourceLine" id="cb2-239" title="239"></a>
<a class="sourceLine" id="cb2-240" title="240"></a>
<a class="sourceLine" id="cb2-241" title="241"><span class="co"># Part 3, Table 13</span></a>
<a class="sourceLine" id="cb2-242" title="242">R97P3S13 &lt;-<span class="st"> </span>R97P3S13 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-243" title="243"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-244" title="244">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-245" title="245">    <span class="dt">insured_loan =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-246" title="246">    <span class="dt">loanfrom =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-247" title="247">    <span class="dt">purchased =</span> DYCOL04,</a>
<a class="sourceLine" id="cb2-248" title="248">    <span class="dt">cost =</span> DYCOL05,</a>
<a class="sourceLine" id="cb2-249" title="249">    <span class="dt">sell =</span> DYCOL06 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-250" title="250"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-251" title="251">    code <span class="op">==</span><span class="st"> </span><span class="dv">51161</span> <span class="op">~</span><span class="st"> </span>51160L,</a>
<a class="sourceLine" id="cb2-252" title="252">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-253" title="253">  )</a>
<a class="sourceLine" id="cb2-254" title="254"></a>
<a class="sourceLine" id="cb2-255" title="255">U97P3S13 &lt;-<span class="st"> </span>U97P3S13 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-256" title="256"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-257" title="257">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-258" title="258">    <span class="dt">insured_loan =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-259" title="259">    <span class="dt">loanfrom =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-260" title="260">    <span class="dt">purchased =</span> DYCOL04,</a>
<a class="sourceLine" id="cb2-261" title="261">    <span class="dt">cost =</span> DYCOL05,</a>
<a class="sourceLine" id="cb2-262" title="262">    <span class="dt">sell =</span> DYCOL06) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-263" title="263"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2-264" title="264">    code <span class="op">==</span><span class="st"> </span><span class="dv">51161</span> <span class="op">~</span><span class="st"> </span>51160L,</a>
<a class="sourceLine" id="cb2-265" title="265">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code)</a>
<a class="sourceLine" id="cb2-266" title="266">  )</a>
<a class="sourceLine" id="cb2-267" title="267"></a>
<a class="sourceLine" id="cb2-268" title="268"><span class="co"># Part 3, Table 14</span></a>
<a class="sourceLine" id="cb2-269" title="269"></a>
<a class="sourceLine" id="cb2-270" title="270">R97P3S14 &lt;-<span class="st"> </span>R97P3S14 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-271" title="271"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-272" title="272">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-273" title="273">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-274" title="274">    <span class="dt">cost =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-275" title="275">    <span class="dt">sell =</span> DYCOL04 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-276" title="276"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">DYCOL00 =</span> code )</a>
<a class="sourceLine" id="cb2-277" title="277"></a>
<a class="sourceLine" id="cb2-278" title="278">U97P3S14 &lt;-<span class="st"> </span>U97P3S14 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-279" title="279"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-280" title="280">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-281" title="281">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb2-282" title="282">    <span class="dt">cost =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-283" title="283">    <span class="dt">sell =</span> DYCOL04) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-284" title="284"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">DYCOL00 =</span> code )</a></code></pre></div>
<p>Sample code for merging all tables in Part 3 for getting a unique expenditure table and generating three variables for province, town, and region codes. <span style="color:red"> Its better to summarize this at item level and then we will match different years with price index. </span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Merging Part 3</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3">R97P3 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(R97P3S01 ,R97P3S02 ,R97P3S03 ,R97P3S04 ,R97P3S05 ,R97P3S06 ,R97P3S07, R97P3S08, R97P3S09, R97P3S11, R97P3S12, R97P3S13, R97P3S14)</a>
<a class="sourceLine" id="cb3-4" title="4">R97P3 &lt;-<span class="st"> </span>R97P3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(R97P3<span class="op">$</span>Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb3-5" title="5">                          <span class="dt">town =</span> <span class="kw">substr</span>(R97P3<span class="op">$</span>Address, <span class="dv">4</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb3-6" title="6">                          <span class="dt">urban =</span> <span class="st">&quot;R&quot;</span>)</a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8">U97P3 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(U97P3S01 ,U97P3S02 ,U97P3S03 ,U97P3S04 ,U97P3S05 ,U97P3S06 ,U97P3S07, U97P3S08, U97P3S09, U97P3S11, U97P3S12, U97P3S13, U97P3S14)</a>
<a class="sourceLine" id="cb3-9" title="9">U97P3 &lt;-<span class="st"> </span>U97P3 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(U97P3<span class="op">$</span>Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb3-10" title="10">                          <span class="dt">town =</span> <span class="kw">substr</span>(U97P3<span class="op">$</span>Address, <span class="dv">4</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb3-11" title="11">                          <span class="dt">urban =</span> <span class="st">&quot;U&quot;</span>)</a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="kw">saveRDS</span>(R97_expenditure, <span class="st">&quot;R97Expenditure.rds&quot;</span>)</a>
<a class="sourceLine" id="cb3-14" title="14"><span class="kw">saveRDS</span>(U97_expenditure, <span class="st">&quot;U97Expenditure.rds&quot;</span>)</a></code></pre></div>
</div>
<div id="cleaning-part-4" class="section level2">
<h2><span class="header-section-number">4.3</span> Cleaning Part 4</h2>
<p>For income tables we first rename the variables in each year to get unique names. We then compute non-monetary income using Part 3.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Part 4, Table 1</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">R97P4S01&lt;-R97P4S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="dt">employed_w =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="dt">ISCO_w =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="dt">ISIC_w =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="dt">status_w =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="dt">hours_w =</span> DYCOL06,</a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="dt">days_w =</span> DYCOL07,</a>
<a class="sourceLine" id="cb4-12" title="12">    <span class="dt">income_w_m =</span> DYCOL08,</a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="dt">income_w_y =</span> DYCOL09,</a>
<a class="sourceLine" id="cb4-14" title="14">    <span class="dt">wage_w_m =</span> DYCOL10,</a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="dt">wage_w_y =</span> DYCOL11,</a>
<a class="sourceLine" id="cb4-16" title="16">    <span class="dt">perk_w_m =</span> DYCOL12,</a>
<a class="sourceLine" id="cb4-17" title="17">    <span class="dt">perk_w_y =</span> DYCOL13,</a>
<a class="sourceLine" id="cb4-18" title="18">    <span class="dt">netincome_w_m =</span> DYCOL14,</a>
<a class="sourceLine" id="cb4-19" title="19">    <span class="dt">netincome_w_y =</span> DYCOL15)</a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21">U97P4S01&lt;-U97P4S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-23" title="23">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-24" title="24">    <span class="dt">employed_w =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-25" title="25">    <span class="dt">ISCO_w =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-26" title="26">    <span class="dt">ISIC_w =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-27" title="27">    <span class="dt">status_w =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-28" title="28">    <span class="dt">hours_w =</span> DYCOL06,</a>
<a class="sourceLine" id="cb4-29" title="29">    <span class="dt">days_w =</span> DYCOL07,</a>
<a class="sourceLine" id="cb4-30" title="30">    <span class="dt">income_w_m =</span> DYCOL08,</a>
<a class="sourceLine" id="cb4-31" title="31">    <span class="dt">income_w_y =</span> DYCOL09,</a>
<a class="sourceLine" id="cb4-32" title="32">    <span class="dt">wage_w_m =</span> DYCOL10,</a>
<a class="sourceLine" id="cb4-33" title="33">    <span class="dt">wage_w_y =</span> DYCOL11,</a>
<a class="sourceLine" id="cb4-34" title="34">    <span class="dt">perk_w_m =</span> DYCOL12,</a>
<a class="sourceLine" id="cb4-35" title="35">    <span class="dt">perk_w_y =</span> DYCOL13,</a>
<a class="sourceLine" id="cb4-36" title="36">    <span class="dt">netincome_w_m =</span> DYCOL14,</a>
<a class="sourceLine" id="cb4-37" title="37">    <span class="dt">netincome_w_y =</span> DYCOL15)</a>
<a class="sourceLine" id="cb4-38" title="38"></a>
<a class="sourceLine" id="cb4-39" title="39"><span class="co"># Part 4, Table 2</span></a>
<a class="sourceLine" id="cb4-40" title="40"></a>
<a class="sourceLine" id="cb4-41" title="41">R97P4S02&lt;-R97P4S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-42" title="42"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-43" title="43">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-44" title="44">    <span class="dt">employed_s =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-45" title="45">    <span class="dt">ISCO_s =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-46" title="46">    <span class="dt">ISIC_s =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-47" title="47">    <span class="dt">status_s =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-48" title="48">    <span class="dt">agriculture =</span> DYCOL06,</a>
<a class="sourceLine" id="cb4-49" title="49">    <span class="dt">houres_s =</span> DYCOL07,</a>
<a class="sourceLine" id="cb4-50" title="50">    <span class="dt">days_s =</span> DYCOL08,</a>
<a class="sourceLine" id="cb4-51" title="51">    <span class="dt">cost_employment =</span> DYCOL09,</a>
<a class="sourceLine" id="cb4-52" title="52">    <span class="dt">cost_raw =</span> DYCOL10,</a>
<a class="sourceLine" id="cb4-53" title="53">    <span class="dt">cost_machinery =</span> DYCOL11,</a>
<a class="sourceLine" id="cb4-54" title="54">    <span class="dt">cost_others =</span> DYCOL12,</a>
<a class="sourceLine" id="cb4-55" title="55">    <span class="dt">cost_tax =</span> DYCOL13,</a>
<a class="sourceLine" id="cb4-56" title="56">    <span class="dt">sale =</span> DYCOL14,</a>
<a class="sourceLine" id="cb4-57" title="57">    <span class="dt">income_s_y =</span> DYCOL15)</a>
<a class="sourceLine" id="cb4-58" title="58"></a>
<a class="sourceLine" id="cb4-59" title="59">U97P4S02&lt;-U97P4S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-60" title="60"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-61" title="61">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-62" title="62">    <span class="dt">employed_s =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-63" title="63">    <span class="dt">ISCO_s =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-64" title="64">    <span class="dt">ISIC_s =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-65" title="65">    <span class="dt">status_s =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-66" title="66">    <span class="dt">agriculture =</span> DYCOL06,</a>
<a class="sourceLine" id="cb4-67" title="67">    <span class="dt">houres_s =</span> DYCOL07,</a>
<a class="sourceLine" id="cb4-68" title="68">    <span class="dt">days_s =</span> DYCOL08,</a>
<a class="sourceLine" id="cb4-69" title="69">    <span class="dt">cost_employment =</span> DYCOL09,</a>
<a class="sourceLine" id="cb4-70" title="70">    <span class="dt">cost_raw =</span> DYCOL10,</a>
<a class="sourceLine" id="cb4-71" title="71">    <span class="dt">cost_machinery =</span> DYCOL11,</a>
<a class="sourceLine" id="cb4-72" title="72">    <span class="dt">cost_others =</span> DYCOL12,</a>
<a class="sourceLine" id="cb4-73" title="73">    <span class="dt">cost_tax =</span> DYCOL13,</a>
<a class="sourceLine" id="cb4-74" title="74">    <span class="dt">sale =</span> DYCOL14,</a>
<a class="sourceLine" id="cb4-75" title="75">    <span class="dt">income_s_y =</span> DYCOL15)</a>
<a class="sourceLine" id="cb4-76" title="76"></a>
<a class="sourceLine" id="cb4-77" title="77"></a>
<a class="sourceLine" id="cb4-78" title="78"><span class="co"># Part 4, Table 3</span></a>
<a class="sourceLine" id="cb4-79" title="79"></a>
<a class="sourceLine" id="cb4-80" title="80">R97P4S03&lt;-R97P4S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-81" title="81"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-82" title="82">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-83" title="83">    <span class="dt">income_pension =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-84" title="84">    <span class="dt">income_rent =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-85" title="85">    <span class="dt">income_interest =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-86" title="86">    <span class="dt">income_aid =</span> DYCOL06,</a>
<a class="sourceLine" id="cb4-87" title="87">    <span class="dt">income_resale =</span> DYCOL07,</a>
<a class="sourceLine" id="cb4-88" title="88">    <span class="dt">income_transfer =</span> DYCOL08)</a>
<a class="sourceLine" id="cb4-89" title="89"></a>
<a class="sourceLine" id="cb4-90" title="90">U97P4S03&lt;-U97P4S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-91" title="91"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-92" title="92">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-93" title="93">    <span class="dt">income_pension =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-94" title="94">    <span class="dt">income_rent =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-95" title="95">    <span class="dt">income_interest =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-96" title="96">    <span class="dt">income_aid =</span> DYCOL06,</a>
<a class="sourceLine" id="cb4-97" title="97">    <span class="dt">income_resale =</span> DYCOL07,</a>
<a class="sourceLine" id="cb4-98" title="98">    <span class="dt">income_transfer =</span> DYCOL08)</a>
<a class="sourceLine" id="cb4-99" title="99"></a>
<a class="sourceLine" id="cb4-100" title="100"><span class="co"># Part 4, Table 4</span></a>
<a class="sourceLine" id="cb4-101" title="101"></a>
<a class="sourceLine" id="cb4-102" title="102">R97P4S04&lt;-R97P4S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-103" title="103"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-104" title="104">    <span class="dt">member =</span> Dycol01,</a>
<a class="sourceLine" id="cb4-105" title="105">    <span class="dt">subsidy_number =</span> Dycol03,</a>
<a class="sourceLine" id="cb4-106" title="106">    <span class="dt">subsidy_month =</span> Dycol04,</a>
<a class="sourceLine" id="cb4-107" title="107">    <span class="dt">subsidy =</span> Dycol05)</a>
<a class="sourceLine" id="cb4-108" title="108"></a>
<a class="sourceLine" id="cb4-109" title="109">U97P4S04&lt;-U97P4S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-110" title="110"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-111" title="111">    <span class="dt">member =</span> Dycol01,</a>
<a class="sourceLine" id="cb4-112" title="112">    <span class="dt">subsidy_number =</span> Dycol03,</a>
<a class="sourceLine" id="cb4-113" title="113">    <span class="dt">subsidy_month =</span> Dycol04,</a>
<a class="sourceLine" id="cb4-114" title="114">    <span class="dt">subsidy =</span> Dycol05)</a></code></pre></div>
<div id="non-monetary-income" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Non-monetary income</h3>
<p>We build non-monetary income as follows and them merge all income tables into one</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># A code for computing nonmonetary income using Table 3</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co"># Merging Part 4</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6">R97P4 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(R97P4S01, R97P4S02, R97P4S03, R97P4S04)</a>
<a class="sourceLine" id="cb5-7" title="7">R97P4 &lt;-<span class="st"> </span>R97P4 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(R97P4<span class="op">$</span>Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb5-8" title="8">                          <span class="dt">town =</span> <span class="kw">substr</span>(R97P4<span class="op">$</span>Address, <span class="dv">4</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb5-9" title="9">                          <span class="dt">urban =</span> <span class="st">&quot;R&quot;</span>)</a>
<a class="sourceLine" id="cb5-10" title="10"></a>
<a class="sourceLine" id="cb5-11" title="11">U97P4 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(U97P4S01, U97P4S02, U97P4S03, U97P4S04)</a>
<a class="sourceLine" id="cb5-12" title="12">U97P4 &lt;-<span class="st"> </span>U97P4 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(U97P4<span class="op">$</span>Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb5-13" title="13">                          <span class="dt">town =</span> <span class="kw">substr</span>(U97P4<span class="op">$</span>Address, <span class="dv">4</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb5-14" title="14">                          <span class="dt">urban =</span> <span class="st">&quot;U&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="building-individual-level-data" class="section level2">
<h2><span class="header-section-number">4.4</span> Building individual-level data</h2>
<p>As part 1 and part 4 are at individual level, we merge them to make unique dataframe containing individual characteristics and income. Later we merge this dataframes over differet survey years by adjusting for prices. It can then be also used as a rotating panel data for 1389 onwards.
<span style="color:red"> Please write a code for this, i didn’t find it </span></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># A code for merging Part 1 and 4 with weight, province, etc.</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">saveRDS</span>(R97_individual, <span class="st">&quot;R97Individual.rds&quot;</span>)</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">saveRDS</span>(U97_individual, <span class="st">&quot;U97Individual.rds&quot;</span>)</a></code></pre></div>
</div>
<div id="building-household-level-data-summary-files" class="section level2">
<h2><span class="header-section-number">4.5</span> Building Household-level data (summary files)</h2>
<p>Together with the raw data, SCI also disseminates the summary files for each HEIS year which includes household level summary data of the survey. With the same idea we build summary files for each year as follows. <span style="color:red"> Please also add total income, variables like household size and other stuff that SCI summary files have here. at the end don’t save global environment and just save </span></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># A code for merging Part 1 and 4 with weight, province, etc.</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># Building Household Data</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">r97p3s1 &lt;-<span class="st"> </span>R97P3S01 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_food =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9">r97p3s2 &lt;-<span class="st"> </span>R97P3S02 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_tobacco =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">r97p3s3 &lt;-<span class="st"> </span>R97P3S03 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="st">  </span><span class="kw">summarize</span>( <span class="dt">cost_clothing =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-18" title="18"></a>
<a class="sourceLine" id="cb7-19" title="19">r97p3s4 &lt;-<span class="st"> </span>R97P3S04 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_housing =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-23" title="23"></a>
<a class="sourceLine" id="cb7-24" title="24">r97p3s5 &lt;-<span class="st"> </span>R97P3S05 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-25" title="25"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-27" title="27"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_furniture =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-28" title="28"></a>
<a class="sourceLine" id="cb7-29" title="29">r97p3s6 &lt;-<span class="st"> </span>R97P3S06 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-30" title="30"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-32" title="32"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_health =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-33" title="33"></a>
<a class="sourceLine" id="cb7-34" title="34">r97p3s7 &lt;-<span class="st"> </span>R97P3S07 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-35" title="35"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-36" title="36"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-37" title="37"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_transportation =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-38" title="38"></a>
<a class="sourceLine" id="cb7-39" title="39">r97p3s8 &lt;-<span class="st"> </span>R97P3S08 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-40" title="40"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-41" title="41"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-42" title="42"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_communication =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-43" title="43"></a>
<a class="sourceLine" id="cb7-44" title="44">r97p3s9 &lt;-<span class="st"> </span>R97P3S09 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-45" title="45"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-46" title="46"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-47" title="47"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_recreation =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-48" title="48"></a>
<a class="sourceLine" id="cb7-49" title="49">r97p3s11 &lt;-<span class="st"> </span>R97P3S11 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-50" title="50"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-51" title="51"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-52" title="52"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_restaurant =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-53" title="53"></a>
<a class="sourceLine" id="cb7-54" title="54">r97p3s12 &lt;-<span class="st"> </span>R97P3S12 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-55" title="55"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-56" title="56"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-57" title="57"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_miscellaneous =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-58" title="58"></a>
<a class="sourceLine" id="cb7-59" title="59">r97p3s13 &lt;-<span class="st"> </span>R97P3S13 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-60" title="60"><span class="st">  </span><span class="kw">select</span>(Address, cost) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-61" title="61"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-62" title="62"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_durables =</span> <span class="kw">sum</span>(cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-63" title="63"></a>
<a class="sourceLine" id="cb7-64" title="64">r97p3s14 &lt;-<span class="st"> </span>R97P3S14 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-65" title="65"><span class="st">  </span><span class="kw">select</span>(Address, cost) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-66" title="66"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-67" title="67"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_investment =</span> <span class="kw">sum</span>(cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-68" title="68"></a>
<a class="sourceLine" id="cb7-69" title="69">R97_cost &lt;-<span class="st"> </span><span class="kw">left_join</span>(r97p3s1 , r97p3s2, <span class="dt">by=</span><span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-70" title="70"><span class="st">  </span><span class="kw">left_join</span>(r97p3s3, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-71" title="71"><span class="st">  </span><span class="kw">left_join</span>(r97p3s4, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-72" title="72"><span class="st">  </span><span class="kw">left_join</span>(r97p3s5, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-73" title="73"><span class="st">  </span><span class="kw">left_join</span>(r97p3s6, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-74" title="74"><span class="st">  </span><span class="kw">left_join</span>(r97p3s7, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-75" title="75"><span class="st">  </span><span class="kw">left_join</span>(r97p3s8, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-76" title="76"><span class="st">  </span><span class="kw">left_join</span>(r97p3s9, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-77" title="77"><span class="st">  </span><span class="kw">left_join</span>(r97p3s11, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-78" title="78"><span class="st">  </span><span class="kw">left_join</span>(r97p3s12, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-79" title="79"><span class="st">  </span><span class="kw">left_join</span>(r97p3s13, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-80" title="80"><span class="st">  </span><span class="kw">left_join</span>(r97p3s14, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) </a>
<a class="sourceLine" id="cb7-81" title="81">  </a>
<a class="sourceLine" id="cb7-82" title="82">  </a>
<a class="sourceLine" id="cb7-83" title="83">u97p3s1 &lt;-<span class="st"> </span>U97P3S01 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-84" title="84"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-85" title="85"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-86" title="86"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_food =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-87" title="87"></a>
<a class="sourceLine" id="cb7-88" title="88">u97p3s2 &lt;-<span class="st"> </span>U97P3S02 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-89" title="89"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-90" title="90"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-91" title="91"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_tobacco =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-92" title="92"></a>
<a class="sourceLine" id="cb7-93" title="93">u97p3s3 &lt;-<span class="st"> </span>U97P3S03 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-94" title="94"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-95" title="95"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-96" title="96"><span class="st">  </span><span class="kw">summarize</span>( <span class="dt">cost_clothing =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-97" title="97"></a>
<a class="sourceLine" id="cb7-98" title="98">u97p3s4 &lt;-<span class="st"> </span>U97P3S04 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-99" title="99"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-100" title="100"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-101" title="101"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_housing =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-102" title="102"></a>
<a class="sourceLine" id="cb7-103" title="103">u97p3s5 &lt;-<span class="st"> </span>U97P3S05 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-104" title="104"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-105" title="105"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-106" title="106"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_furniture =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-107" title="107"></a>
<a class="sourceLine" id="cb7-108" title="108">u97p3s6 &lt;-<span class="st"> </span>U97P3S06 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-109" title="109"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-110" title="110"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-111" title="111"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_health =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-112" title="112"></a>
<a class="sourceLine" id="cb7-113" title="113">u97p3s7 &lt;-<span class="st"> </span>R97P3S07 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-114" title="114"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-115" title="115"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-116" title="116"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_transportation =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-117" title="117"></a>
<a class="sourceLine" id="cb7-118" title="118">u97p3s8 &lt;-<span class="st"> </span>U97P3S08 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-119" title="119"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-120" title="120"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-121" title="121"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_communication =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-122" title="122"></a>
<a class="sourceLine" id="cb7-123" title="123">u97p3s9 &lt;-<span class="st"> </span>U97P3S09 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-124" title="124"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-125" title="125"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-126" title="126"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_recreation =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-127" title="127"></a>
<a class="sourceLine" id="cb7-128" title="128">u97p3s11 &lt;-<span class="st"> </span>U97P3S11 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-129" title="129"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-130" title="130"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-131" title="131"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_restaurant =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-132" title="132"></a>
<a class="sourceLine" id="cb7-133" title="133">u97p3s12 &lt;-<span class="st"> </span>U97P3S12 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-134" title="134"><span class="st">  </span><span class="kw">select</span>(Address, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-135" title="135"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-136" title="136"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_miscellaneous =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-137" title="137"></a>
<a class="sourceLine" id="cb7-138" title="138">u97p3s13 &lt;-<span class="st"> </span>U97P3S13 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-139" title="139"><span class="st">  </span><span class="kw">select</span>(Address, cost) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-140" title="140"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-141" title="141"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_durables =</span> <span class="kw">sum</span>(cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-142" title="142"></a>
<a class="sourceLine" id="cb7-143" title="143">u97p3s14 &lt;-<span class="st"> </span>U97P3S14 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-144" title="144"><span class="st">  </span><span class="kw">select</span>(Address, cost) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-145" title="145"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-146" title="146"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost_investment =</span> <span class="kw">sum</span>(cost, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb7-147" title="147"></a>
<a class="sourceLine" id="cb7-148" title="148">U97_cost &lt;-<span class="st"> </span><span class="kw">left_join</span>(u97p3s1 , u97p3s2, <span class="dt">by=</span><span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-149" title="149"><span class="st">  </span><span class="kw">left_join</span>(u97p3s3, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-150" title="150"><span class="st">  </span><span class="kw">left_join</span>(u97p3s4, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-151" title="151"><span class="st">  </span><span class="kw">left_join</span>(u97p3s5, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-152" title="152"><span class="st">  </span><span class="kw">left_join</span>(u97p3s6, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-153" title="153"><span class="st">  </span><span class="kw">left_join</span>(u97p3s7, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-154" title="154"><span class="st">  </span><span class="kw">left_join</span>(u97p3s8, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-155" title="155"><span class="st">  </span><span class="kw">left_join</span>(u97p3s9, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-156" title="156"><span class="st">  </span><span class="kw">left_join</span>(u97p3s11, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-157" title="157"><span class="st">  </span><span class="kw">left_join</span>(u97p3s12, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-158" title="158"><span class="st">  </span><span class="kw">left_join</span>(u97p3s13, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-159" title="159"><span class="st">  </span><span class="kw">left_join</span>(u97p3s14, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) </a>
<a class="sourceLine" id="cb7-160" title="160"></a>
<a class="sourceLine" id="cb7-161" title="161"></a>
<a class="sourceLine" id="cb7-162" title="162">R97_cost &lt;-<span class="st"> </span>R97_cost <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-163" title="163"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(R97_cost<span class="op">$</span>Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb7-164" title="164">         <span class="dt">town =</span> <span class="kw">substr</span>(R97_cost<span class="op">$</span>Address, <span class="dv">4</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb7-165" title="165">         <span class="dt">month =</span> <span class="kw">substr</span>(R97_cost<span class="op">$</span>Address, <span class="dv">10</span>, <span class="dv">11</span>),</a>
<a class="sourceLine" id="cb7-166" title="166">         <span class="dt">urban =</span> <span class="st">&quot;R&quot;</span>)</a>
<a class="sourceLine" id="cb7-167" title="167"></a>
<a class="sourceLine" id="cb7-168" title="168">U97_cost &lt;-<span class="st"> </span>U97_cost <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-169" title="169"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(U97_cost<span class="op">$</span>Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb7-170" title="170">         <span class="dt">town =</span> <span class="kw">substr</span>(U97_cost<span class="op">$</span>Address, <span class="dv">4</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb7-171" title="171">         <span class="dt">month =</span> <span class="kw">substr</span>(U97_cost<span class="op">$</span>Address, <span class="dv">10</span>, <span class="dv">11</span>),</a>
<a class="sourceLine" id="cb7-172" title="172">         <span class="dt">urban =</span> <span class="st">&quot;U&quot;</span>)</a>
<a class="sourceLine" id="cb7-173" title="173"></a>
<a class="sourceLine" id="cb7-174" title="174">r97data&lt;-<span class="st"> </span>R97Data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Address, Fasl, weight, NoeKhn)</a>
<a class="sourceLine" id="cb7-175" title="175">u97data&lt;-<span class="st"> </span>U97Data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Address, Fasl, weight, NoeKhn)</a>
<a class="sourceLine" id="cb7-176" title="176"></a>
<a class="sourceLine" id="cb7-177" title="177">R97_Household &lt;-<span class="st"> </span><span class="kw">left_join</span>(R97_cost , R97P2, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(r97data, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>)</a>
<a class="sourceLine" id="cb7-178" title="178">U97_Household &lt;-<span class="st"> </span><span class="kw">left_join</span>(U97_cost , U97P2, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(u97data, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>)</a>
<a class="sourceLine" id="cb7-179" title="179"></a>
<a class="sourceLine" id="cb7-180" title="180"><span class="kw">saveRDS</span>(R97_Household, <span class="st">&quot;R97Household.rds&quot;</span>)</a>
<a class="sourceLine" id="cb7-181" title="181"><span class="kw">saveRDS</span>(U97_Household, <span class="st">&quot;U97Household.rds&quot;</span>)</a></code></pre></div>
</div>
<div id="special-issues-for-different-years" class="section level2">
<h2><span class="header-section-number">4.6</span> Special issues for different years</h2>
<p><span style="color:red"> Was there any specific issue that we have to correct in a specific round except what explained above? Like the number of items etc. </span></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="importing-raw-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="price-adjustment-and-appending.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
